set default=2
set timeout=1

# Force text mode and enable serial console for early OS output
insmod serial
set gfxpayload=text
serial --unit=0 --speed=115200 --word=8 --parity=no --stop=1
terminal_input serial console
terminal_output serial console

menuentry "UEFI Hello (chainload BOOTX64.EFI)" --class efi {
    if [ -f ($root)/EFI/BOOT/BOOTX64.EFI ]; then
        chainloader ($root)/EFI/BOOT/BOOTX64.EFI
        boot
    elif [ -f ($root)/EFI/BOOT/BOOTAA64.EFI ]; then
        chainloader ($root)/EFI/BOOT/BOOTAA64.EFI
        boot
    else
        echo "No UEFI app found in EFI/BOOT"
    fi
}

menuentry "Multiboot2 kernel (x86, serial @ COM1)" {
    multiboot2 /boot/kernel.elf
    boot
}

menuentry "Long mode: loader32 + kernel64" {
    multiboot2 /boot/loader32.elf
    module2 /boot/kernel64.bin
    boot
}
